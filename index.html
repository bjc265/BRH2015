<!DOCTYPE html>
<html>
	<head>
		<title>Something Catchy</title>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
	    <!-- Optional Bootstrap theme -->
	    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css"><script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js" charset="utf-8"></script>

	    <!-- D3 -->
	    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css"><script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js" charset="utf-8"></script>

	    <!-- C3 stuff hosted on my website because it wouldn't work locally >.> -->
	    <link href="http://www.simplydevio.us/hack/c3.css" rel="stylesheet" type="text/css">
		<script src="http://www.simplydevio.us/hack/c3.min.js"></script>

		<style>
			.container{
				padding: 50px 30px;
				text-align: center;
			}

			#button {
				background: #2a52a2;
				border-radius: 3px;
				padding: 8px 30px;
				border: none;
				color: #fff;
			}

			#title{
				margin-top: 40px;
				height: 50px;
			}

			#chart{
				text-align: center;
			}
		</style>
	</head>
	<body>
		<div id="wrapper" class="container">

			<input id="button" type='button' onclick='submitQuery()' value='Random'>
			<h2 id="title"></h2>
			<script>

			/*$.getJSON('/list/',function(data){
				$('#wrapper').append(JSON.stringify(data));
			});*/

					//retrieve catalog info
					
				function submitQuery(){

					resetDisplay();

					//retrieve data
					$.ajax({
			   			type: 'get',
			    		url: 'http://localhost:8080/new',
			    		success: function(data, textStatus, jqXHR) {
			    			//$('#wrapper').append('<p>' + data + '</p>');
			    			var parsed = JSON.parse(data).Items;

			    			// ie COWSTOTT Index
			    			var index_id = parsed[0].Ticker;

			    			// Get table description
			    			$.ajax({
					   			type: 'get',
					    		url: '/info/',
					    		data: 'ticker=' + encodeURI(index_id),
					    		success: function(data, textStatus, jqXHR) {
					    			var parsed = JSON.parse(data);
					    			var title = parsed.Description;
					    			$('#title').html(title);
					    		}
							});
			    			generateGraph(parsed);
			    		}
					});
					

					//retrieve data
					/*$.getJSON('/new/', function(data){
						$('#wrapper').append(JSON.stringify(data));
					});*/
				}

				// Creates the c3 graph
				function generateGraph(parsed){
					
	    			var graph_data = [];

	    			for (var i = 0; i < parsed.length; i++){
	    				var obj = {date: parsed[i].Date, value: parsed[i].Value};
	    				graph_data.push(obj);
	    			}

	    			var chart = c3.generate({
					    data: {
					        json: graph_data,
				            keys: {
								x: 'date', // it's possible to specify 'x' when category axis
				                x_format: '%Y-%m-%d',
				                value: ['value'],
				            }
					    },
					    axis : {
					    	x : {
					    		type: 'timeseries'
					    	}
					    }
					});
				}

				// Clears display and indicates loading
				function resetDisplay(){
					$("#title").html("");
					$("#chart").html("<img src='http://www.simplydevio.us/hack/loading.gif' class='loading-gif'>");
				}
				</script>

			<div id="chart"></div>	
			</div>
			
		</body>
	</html>